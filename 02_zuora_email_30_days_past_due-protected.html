<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
