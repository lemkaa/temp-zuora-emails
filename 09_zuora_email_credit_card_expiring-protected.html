<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "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";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
