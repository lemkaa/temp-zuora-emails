<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noindex, nofollow">
    <title>Password Protected Page</title>
    <style>
        html, body {
            margin: 0;
            width: 100%;
            height: 100%;
            font-family: Arial, Helvetica, sans-serif;
        }
        #dialogText {
            color: white;
            background-color: #333333;
        }
        
        #dialogWrap {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: table;
            background-color: #EEEEEE;
        }
        
        #dialogWrapCell {
            display: table-cell;
            text-align: center;
            vertical-align: middle;
        }
        
        #mainDialog {
            max-width: 400px;
            margin: 5px;
            border: solid #AAAAAA 1px;
            border-radius: 10px;
            box-shadow: 3px 3px 5px 3px #AAAAAA;
            margin-left: auto;
            margin-right: auto;
            background-color: #FFFFFF;
            overflow: hidden;
            text-align: left;
        }
        #mainDialog > * {
            padding: 10px 30px;
        }
        #passArea {
            padding: 20px 30px;
            background-color: white;
        }
        #passArea > * {
            margin: 5px auto;
        }
        #pass {
            width: 100%;
            height: 40px;
            font-size: 30px;
        }
        
        #messageWrapper {
            float: left;
            vertical-align: middle;
            line-height: 30px;
        }
        
        .notifyText {
            display: none;
        }
        
        #invalidPass {
            color: red;
        }
        
        #success {
            color: green;
        }
        
        #submitPass {
            font-size: 20px;
            border-radius: 5px;
            background-color: #E7E7E7;
            border: solid gray 1px;
            float: right;
            cursor: pointer;
        }
        #contentFrame {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        #attribution {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            text-align: center;
            padding: 10px;
            font-weight: bold;
            font-size: 0.8em;
        }
        #attribution, #attribution a {
            color: #999;
        }
        .error {
            display: none;
            color: red;
        }
    </style>
  </head>
  <body>
    <iframe id="contentFrame" frameBorder="0" allowfullscreen></iframe>
    <div id="dialogWrap">
        <div id="dialogWrapCell">
            <div id="mainDialog">
                <div id="dialogText">This page is password protected.</div>
                <div id="passArea">
                    <p id="passwordPrompt">Password</p>
                    <input id="pass" type="password" name="pass" autofocus>
                    <div>
                        <span id="messageWrapper">
                            <span id="invalidPass" class="error">Sorry, please try again.</span>
                            <span id="trycatcherror" class="error">Sorry, something went wrong.</span>
                            <span id="success" class="notifyText">Success!</span>
                            &nbsp;
                        </span>
                        <button id="submitPass" type="button">Submit</button>
                        <div style="clear: both;"></div>
                    </div>
                </div>
                <div id="securecontext" class="error">
                    <p>
                        Sorry, but password protection only works over a secure connection. Please load this page via HTTPS.
                    </p>
                </div>
                <div id="nocrypto" class="error">
                    <p>
                        Your web browser appears to be outdated. Please visit this page using a modern browser.
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div id="attribution">
        Protected by <a href="https://www.maxlaumeister.com/pagecrypt/">PageCrypt</a>
    </div>
    <script>
    (function() {

        var pl = "l/mzALNZZI1+/JfFqWhdP+iheqqgtb98rT+NztW+niHldC+FygJ6NNu8UfnTPVcgDh9moLijAlfrWiOnok3OG7T0dCfU9FUH59P1YBDfizC0jrT6qAK5onP9QszvvSVpXKh4Sdi0ANkvspKMuQozedAuOFrQcsMnA1HymUS5Nc0aapyTMXseRLo9ywoUByugCFVYA+7N/1TkZS6O4tdPsdHHIgOsJtfdmo1VN2j/O3E6OMmK/6ITE6sgliOUHF/Yxpn7/q3YsZc5ljx1rA7IrssM+76kf2vxh9hUmNGjwb5RjpaCIcEmhaAoEzWDDGHPRwnQ1B5NqixsVU9HOYetTJvMIVHr4RCvZqPrct+rbT8Y7oPhW4H0ctvFFmeMO9ocEUaZnjvEiABw0igkwQUK9cVeL8NnVBPQeP1cXGYyD0PmcM9dntB1JX0gLVfNY043h2xleFwLqaaPJoUaMzgDmnUPccjYHDV7zvJUTsZ/ENb+VNAUh7uYhstYZVcwMkyBukUOPzH00JJBLuJ2/QG6Nn1JD4LEVORH0hKsZ6F8/8vSYLfxFw9DHD24wr8xZeDkhELxk1gDQdhKhEq7SjKc9tcXjXnv3+bIPamNYLQ7xIE7KNOfIWZszgeUGGh7yy5gcs7S2MU8jIXl/h0HC+Lgqc78tM44ephLEnmBfngpAbBFB9X3Z+EyzCimozrJALDOEvNvclw4NzDDU7VmwOVzO3zzOH3H85mLzcoqIf+mxdtjhg6lzRVXmK5To8AZ3z0nUAZFb5JP+2B1ceuchxrB+4lvBucAbh4bYr0YJdwpvBHg4ofvMfJ1ET6XzrFerXOAUPTPyv9Tna++k66DJ5MhDzIyRNgJBc04Yft7Pvpeks6g/r6L9xgR0TW0FTsubrZk9G3NWJKXIp2Pp6Zt9UPwg80ZIwIC+houfE2QC+EU23Hg9p/3GWnQJh70MdbQYmlFp2KTN8qOfmpk3iDgMAxZ8iZVLf04s092zA6xAmQypIYPeFJ/jjhsOGpdtS1ZT4CmFskWELwa0jPbDA+s4ZXvIi2Q41DtfiOpFbQyXeFgB1DSeLg/QPoXNOyGUulydAMMl75L6QBj5X4GvJKotAXUTd5/tLbmXp0gJwU4oMn8EXgLbVpPUvuJ7aXUL4TuuQhKaOKm/M+eTIvCq7mDkmFJq2W91LcQEzroYZXsNx6S4feqYLEo8l5VyWe+rWaSWHh6fE+k+A85Na/IUusL+ldF6tlajsSAw7RmlbGS8I61m7IVnqDYQ8uOJRrmQjvQropWB/BA9MYNsfFoPhOJTUvLw/02QOWq+V8qNGjRpbVA6fX9dNTp+NBEFypZNhWBhqWHVuKEJBHDObFoCZZhxWOCII8YuXdrds8NeoxypHQcY6Mn19oWfQP5ZdlJvw9kReHYxjZhtlKeYzzGY2ZLsbtSn4tS+EeLRKhBIUbTW3N/pn+cGhGBdqINLga+dcF873hWfpRtlLMz8vkGQGWNTkfenBG/eJ97UHKS+r6Tvhg6CjUQfLyfXEJfou1j3E5rE1bDh2zjzfmwz9EwbeQ3wfCeVyXQ5yP+vAO0y4DTOXBPGoYQyb0c0mJmH5KKpUPLd9n0jJSqcCrAKl90Tlhu1A3mtlNB4wayVZAlLVDIvQQnh4hS4KM0DgrLE69UPeOf8ImZqOQjpOfQz0xbQ5Jv+UnjN7MpFj5ExPu6BPixx3uWzGG/gXu6Z3MIkLENq4KabxPx4/yV6oJUlj6kHI3Lb3BXImT9UgS3zqM3awBX1jXGZd2z5fyVkPe6kEEJ1tdrnjDOXJvuUqnd78wLMb3PBYuArs1d6FX0UFd3S7u99uqaB7TlLRtLnW5n7P0ytP0nyxDfLk/XFsg3TRFfM9fYxvU9PxWP9TjbHQMk8xt4SYvZw79gjxnLqG4PDvAZshC+u643TwkqWttbPnQsv6Oi3bsUjXxrvlAKgaQc/rjfB30qmiH7wCr6ZAC13jIDoK7DM/I4IcjN2+0jtS4/+abcGB5Y8LxAoPyINO7HkQgnURO2//FxGpUDg7oMG6EVoYrZnPyknL0CBrDflipr/nM2Chdo+zg1QsfGsC8WVxZHUpfkjBV/Z03khjJNlu+gQ0Aaoz6EcIwzbJa+mG0amA2RfDTk3qqa9UIocj7jgurDCSuhFDpzSqJDGFCayskud/Aiz18GBURUUeOmt5LTtr1Knvjhv0bJf0K1tLs9KmygIaYeq9AbK4Ww3tpy/q2Y8aHQRgq4IShsUqAoheZXYKfbx7kKY6knJ0ll10XgAKAhjJOntUIWqs644ZgMF5BZqwUNXzBnuI1v3RR4l1a9TJuw7RWImNSCeOqkGHLvTNkpT5Sjta0DvnFTwGF3a5/lwgLALkUbRRFBg/L9CrWiAl/EcPFLzzwGazbE/NhR3bqIGjqxaGMlWlbZKz0G5IHW6L9NcngRlxzRj+qRrFM70PLHR2ce5NE8JAQlmHbEh1qbM8JkSe1ICa7klLUke4X5GLnjBjMneAo+VVPzWCopvtyQKl7V86+cqSgNCLKJQAHWYZtK8BCMwl988UQ2vXOhQ0wNtt9z+rWMb7Fovkmep3bvfImJkzs6ednf1iqN8TwUfSO8Eb+PFZklq008ny8OHnUU83qcaj2jJEkXAbTjfJpZNNSRMgRcrsnlYTyyE3SC2DXqqhWtMm4gAWOxyN/9dx19bn17Cbyueu3PL0tsCr8DZeBTwmtMtyb3ABhX1OLxN6ZVEkXh/OpWbb/EL/S+l8C3lELGe+65fQbomfPq75ZocKYYlNjzWb7JafWJ6Guw39bQlCUg4JKeI9fEHPgKvOLGvK0sEkVgKEM14y/MR93ysT5NwPi+vUTQiwmEtOuyZc7tMLTiqsZnoUx1T5KO5AKTgP/p02L2mQvb3bEk23XBpRXMJGSLAXHh1P1wbQ1LwQX8smPDoMwUu4D++lv5Pt9gfHn/SFy/aMwQCCPA1aRK6SIymXPnyg/yem/dleiGifpFz+WVVtWZfN9Rv9Q14p/Sm6/CtTxnu5wTXdzdpBmS6f1mL+yBe+vIStwttLu9NIJbnGRVIuKs/twFzcOMz4uxf1ER0OkUhzB5OLAUv0/SkHz3wO/YmeeMR4SdftvUa2XiT3cKTBJB5L/wOARA1XHQpVU7j6J3qwIKrSYI/nc8zDgLoZjm2nt5+m/oCK/D4j2yxUrMnLaaQ+NgPHffljU07Yv6rTyqckT6yxN8aWj8A6gVwXCrxmcBtStvgNJRmzaSinl6CXfT+Y1t35BeWuARdv/UrhypoKzPVP3yUOGKyEwwlf3EboXzzOFeWZ/x6mVu5zjccsc3C9k50PKdV1O1xEzwt1Qk/MIQx2fZTovYgZn5d7D+Jm3RN+zVXoSSo7sam5285ghBOgausbSI7e23YMI5GYrqBFAzUX4lmzCiCop+dm6di3VGvT9rwLnTsH1kYXWjyvsNAfD+u7kiDbew1GfamQKsiRasTelb4D+8Nyf+wA2p7k4thC33TnNilBZ5P+wI095dZHL30UZm7a4aU+hBxACInFedCax/cQhY1sl+dfAOJkIJCZKVG+0I9vYdNrV3sR3KX4DNh+r55wybpkxeFJ3xMasdqSML1vFQ5/XA1p+eb+vDB5Cz3MEhNEXVBlAQdT9H8FRR+QWz/BkGisXNxFDnn88ngYuVxGRp2HXqZNk3zh6xfs4z+u06T0PNeCQJqSHOMEp9yCys5ZZQwJXWPgTXl0garMrRCX1X+SqQVdsAQQCwW04EoRJBRth51ayY9w9My/QSwNWjeiOkvL634wHIt610+o6ry42yKfi2WjMYHU1ZyQEnrD9Y0OlY2XSLoHgLy6dMpRxHKOzumltFLVdS0gWk/Pv1605CtQnqHkQl+zkI8Grmz3GfIlzm8y4vNt40b+ipLPgZK9UmpCMtmKb5qJ77VTdiQPXOEh9i1M6tckYWYu1iO52vf0LZo2OqD+hasQ4v2uwkg557LTA9vvQo+MWrHQEL1I1KhSgdSCTrYPOMZzi/6VILUSMCi4MgPhc1G0aUWogIdD6thYNiA+2NAy2zMIuLovyr7aD4csuh+AkOH1GCd4bberoRy2tpd/g53Jy3A95MsPbRzI4I8duLqk3eVi4ZaJIVHYAvsrnIvdU0jDz16mSG0GhWPyzOMdhw59sqb3+dI8Pu2UqZZ2PRgfe+OAJq9pcjokAe7OWZ71CeKR5q2xv1RCccvpfAN7gG2cQcS3urRbvI3XCN9mZqruJF3kKGjRaVuerGrDD0a36RlvdoUFWAapsXIPqWgSO3IIZsxQM8VZAxyBMBPXORDmmcsnVimuKMro2QTfq85IWWo24CPII0bbjasSYaeYKTFT9J8lnZnmXaQtxsW99Wc1vO/0LeiRqkSIvTAQf8Nobg/7qXRXCFYsizRDU/yNzsEZ3MtlfQUALWA9qwhRMcBcTX9TI1/t2n3SYq3ageYIduB4JU1RbpflIKzoS51nrZCrNF9hEY084ibnQWkxKCFirW2sD6Mjg4ovtqdFjcybcqyLQOMYeZGaPO6ZXdlpnCyhF9RG4/MkLBeHLCXj2tX2SE/OBgWEqACdQCmMWfmQbMfBEiokx+jmyl2MPCHJeDOR0qRw6ChGmKfOEe3qD/xKXfvsFAzLRzNtoFR6jtVVYRtIVky1xzzoOzsL18Jf+ueC03ETwuayWegIEfJxo0ibZVL03a93MI+WmmT3irUu9cvoEY37yco+wLGiUZdrw9kzI0f8jQdCoHCokHvC1vYuMgXpYaOIsSQf6mSpHeYT+aW5Qrgp9hYvXom9AhlcaAIm3cY/NcoJzfU3VkIQzLHflbeB5StORyeAtMd5fX50eGgzD2XYp6js+M2M7UdtyogyOaZCpszjSSjL4KSsumRF6cKkwwRD9AG05pDJ7uo9JwMjI12jjQ+EmyxDggf8jbAy7xxSjnupE6frxS+fRts6PW9F0LXFCKhUfu624mfePyZBifyyZkAcjdkTiLYgXgNJ8lRhCMhoqlbHCY3bzbvwsLIZX2HNt8E0TVxzR7i7IrDkBxPe4XyHg5hBWx07nBFXUjE5HLX13qpAMOsCfVsQWL8QRctpvRXA9VucXrJzdTx9mBRnuAvo6z9/glTeMtITF2ZXcPE7eWeJ8fwRMNy8T2ynDS0XE3NIQ9JKA/w1Ny8HWl01IL3ckbKa3iccoo8HPYm62I6zYqlH1YTXs2W9EPhIrfFP2Hz3QX/Snn1XyKFGtHc9YbfADJNgPMy/JfpV5yfSZPTpt8oaojeJBjLixEci4+6iZ6705eY48f1IMAzhQS3BIJ6oFwcQC4FyJr3IPSNBsyD64r9qHQvSQlWm5QyVwNQgIfCT4yruNoAO+cYp+akepV43Rr+KoY7ROpZBajxhwjm1mG28tEm/MkNkgjcFUlEvwLmV48CJEKCQoxZV7IP+8jZ7g+sVEwRHzq1eXg0ynP497zB0Ge3cXnS5Lgogt233bxVTsP/dS0PkPUA173C7IeWxBkWk5KQiJ78U662N7a51Mh0QeLUIIWsx5zVK53Ei+r+Siy0BhFtYRP/gz/aV6Cm/DXK4ynrXZocs78Q1thKzbaHA7RI8z9FcJLc+1Dtq6ubHHeAG9ypRQaUumGIK9uxDAowHcZ/t2pXP2ndGk78tdp4dFXRxqq7dWr7ETysaE/6uWuudqtHfD2hyexvQQRUNMY9HjqM+H3J2IsKZmzJ4jJaNbCGZzi3G+Z9OVbtPibPkSn0NWimBcE8AWMOh6KsGg91q2tZFA9ncKTZfNrmLh43louxWu4WhlkEKIcIZFgUR7tLv/v185BJfdRoZ5RPEkZ6bPwM2h6YDkNzeDX3AyyuQxv8S9ULYecrhA3lPT8c1XxIYVbvl7c87LRyjZZomLlk0ZzCpEA+FqihGmNUcNhZvwNqnupXcM9uVTJc+aYCK60GbtS+sDvoqntBCNhthumEBBUTE97X41Dkxt94nh3q2HzLtL/hToLWR/30ed0YgsZcd9BDbjqgJTxP5LzbCyJv80oNJBZMPoDMoLaYT35a5l+I7pfDpukhLMDKJ+Yqx+28D60XPzlTN5eNBIsI/+u/HXK7qv8WXxPmWvUzz7fQY6zh31HDIv56HI+CR/dR/ky7Cl0ZRC3Y2hdjqmvj18BFXHNT2SuMNuPCRphbuGUWc6HqkmM8P7O0bKxBLoXhR/OKh86gNG8S0g25Bv8/O3+4pjk1qJxt+byBg/1/+L9ugE+xij37xtl9KZ6XrWHFlOqFqhtU3hIM2CrrZK7bZLsyIspegTOh2vvYFHmeZ5bD+vb/j3RZ5gfJynFRwhqI26g5k6SJnLfA23aBz27Md8iBvgQPu4wjkU35lsiBRFLk+nhkpqoRXyCF6cgYiErq1QN4tJ/XWV+NxJsKG3jtQlzI1UtPK5G2jrD91SdlVsBU5tNHoEsmzaG93uw40C9apn/jQyIV5lv7T2QYs6oPAeAzjCSVCZnKjNLa+/cQmSmXrdxEJmnBDqMx+LAU1BDR3+n3+UZrSIn6yaKQ1MjNli7M3MkGK5NF6fdWtYsSRxlSG2Xm/FDYK8TmznxBmWL/TIQFGSE3n88J2B1Jas5vHaMWBikHx5xFnss3DMj+NP39lE+VAgBYPqSlCIFqfFgqMgwKMp379wkBnUI3QylIoqhFjlm1GwD+tKW1vRu0EfooLYoNJwAt5RTIdb05Ok1HhJBSRVcxJyWz/TNnzbPRyrQsQC6Y791JNK77EsjFyv41XUaFZqMVTTFmfWuQmniMGdmdrJkgizpFhNFyOE1gkLN2wneqnfrbe3ZbSFtM343SKY7e35gFGCLIjlXYqe1uO1Qaj86rwgsRMz4aVLHiMFdS7YjbZfJQj11oTunn1ZfEgj1J8/u9bCeXSd78I/bzaeBLAVfKq8dMdbg6qcn8N/2QMi+h7/35oijvOOsNrMC+5s3QfGgOAm1Bc8FgTB569rsjracw6BS8EnLRSUgX0U52EgP0N5epWKDAA6/bOP2HCdu20h2ylp2nQjDRnkL9JKxa8xwyxamQENtJ+a4tQ4VeA/upCWrXFyaIUA8iNlwLv9S5UZCV175tTrD1LaWD/YmAMsYFDYLF1W9QF+72w0hndpRl/mQMP7ToD7WRgBAMfMG1tI5TaeC+PjIIMdTyf/savCw1dE4pA3bwli1CfUH+Ir7kYLPV6i/6Yn+7rvVC7D2FbMja6Pz4txk/yDHzYAdQW4W2Bq5VLD1RRGSX4NfJ80OEKBJTG13McsHZk1AT681m7KYXbpgnzubO8H3YPz9qnE3RDjft/2Mnu+QYBsvaJBrB12Nbh/KA0+HyCi/tTtBib7qfsLrtItMSg3W";
        
        var submitPass = document.getElementById('submitPass');
        var passEl = document.getElementById('pass');
        var invalidPassEl = document.getElementById('invalidPass');
        var trycatcherror = document.getElementById('trycatcherror');
        var successEl = document.getElementById('success');
        var contentFrame = document.getElementById('contentFrame');
        
        // Sanity checks

        if (pl === "") {
            submitPass.disabled = true;
            passEl.disabled = true;
            alert("This page is meant to be used with the encryption tool. It doesn't work standalone.");
            return;
        }

        if (!isSecureContext) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#securecontext").style.display = "block";
            return;
        }

        if (!crypto.subtle) {
            document.querySelector("#passArea").style.display = "none";
            document.querySelector("#nocrypto").style.display = "block";
            return;
        }
        
        function str2ab(str) {
            var ustr = atob(str);
            var buf = new ArrayBuffer(ustr.length);
            var bufView = new Uint8Array(buf);
            for (var i=0, strLen=ustr.length; i < strLen; i++) {
                bufView[i] = ustr.charCodeAt(i);
            }
            return bufView;
        }

        async function deriveKey(salt, password) {
            const encoder = new TextEncoder()
            const baseKey = await crypto.subtle.importKey(
                'raw',
                encoder.encode(password),
                'PBKDF2',
                false,
                ['deriveKey'],
            )
            return await crypto.subtle.deriveKey(
                { name: 'PBKDF2', salt, iterations: 100000, hash: 'SHA-256' },
                baseKey,
                { name: 'AES-GCM', length: 256 },
                true,
                ['decrypt'],
            )
        }
        
        async function doSubmit(evt) {
            submitPass.disabled = true;
            passEl.disabled = true;

            let iv, ciphertext, key;
            
            try {
                var unencodedPl = str2ab(pl);

                const salt = unencodedPl.slice(0, 32)
                iv = unencodedPl.slice(32, 32 + 16)
                ciphertext = unencodedPl.slice(32 + 16)

                key = await deriveKey(salt, passEl.value);
            } catch (e) {
                trycatcherror.style.display = "inline";
                console.error(e);
                return;
            }

            try {
                const decryptedArray = new Uint8Array(
                    await crypto.subtle.decrypt({ name: 'AES-GCM', iv }, key, ciphertext)
                );

                let decrypted = new TextDecoder().decode(decryptedArray);

                if (decrypted === "") throw "No data returned";

                const basestr = '<base href="." target="_top">';
                const anchorfixstr = `
                    <script>
                        Array.from(document.links).forEach((anchor) => {
                            const href = anchor.getAttribute("href");
                            if (href.startsWith("#")) {
                                anchor.addEventListener("click", function(e) {
                                    e.preventDefault();
                                    const targetId = this.getAttribute("href").substring(1);
                                    const targetEl = document.getElementById(targetId);
                                    targetEl.scrollIntoView();
                                });
                            }
                        });
                    <\/script>
                `;
                
                // Set default iframe link targets to _top so all links break out of the iframe
                if (decrypted.includes("<head>")) decrypted = decrypted.replace("<head>", "<head>" + basestr);
                else if (decrypted.includes("<!DOCTYPE html>")) decrypted = decrypted.replace("<!DOCTYPE html>", "<!DOCTYPE html>" + basestr);
                else decrypted = basestr + decrypted;

                // Fix fragment links
                if (decrypted.includes("</body>")) decrypted = decrypted.replace("</body>", anchorfixstr + '</body>');
                else if (decrypted.includes("</html>")) decrypted = decrypted.replace("</html>", anchorfixstr + '</html>');
                else decrypted = decrypted + anchorfixstr;
                
                contentFrame.srcdoc = decrypted;
                
                successEl.style.display = "inline";
                setTimeout(function() {
                    dialogWrap.style.display = "none";
                }, 1000);
            } catch (e) {
                invalidPassEl.style.display = "inline";
                passEl.value = "";
                submitPass.disabled = false;
                passEl.disabled = false;
                console.error(e);
                return;
            }
        }
        
        submitPass.onclick = doSubmit;
        passEl.onkeypress = function(e){
            if (!e) e = window.event;
            var keyCode = e.keyCode || e.which;
            invalidPassEl.style.display = "none";
            if (keyCode == '13'){
              // Enter pressed
              doSubmit();
              return false;
            }
        }
    })();
    </script>
  </body>
</html>
